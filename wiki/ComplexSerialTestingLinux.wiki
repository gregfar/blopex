#summary BLOPEX Complex Serial testing on Linux
<wiki:toc max_depth="1" />

= Introduction =

How to test the complex serial driver for BLOPEX. 

This is a c program  (serial_driver) which was created for testing of the
complex additions to blopex_abstract.  It is similar to blopex_serial_double but 
  # deals only with complex matrices, 
  # matmultivec, pcg_multi, and multivector routines have been modified to handle complex matrices and vectors, 
  # calls lobpcg_solve_complex, and 
  # the serial_driver.c has been enhanced for additional test options.

The serial_driver does not require installation of Petsc or Hypre. 

= Compile/Link serial_driver = 

For the following assume all BLOPEX source is installed uner directory BLOPEX.

If BLOPEX library has not been created then do this first. 

Change directory to BLOPEX abstract code directory and issue make command.
{{{
>>cd BLOPEX/blopex_abstract
>>make
}}}

Change directory to the code for the complex serial_driver.  
{{{
>>cd BLOPEX/blopex_serial_complex
}}}
To create the executable for serial_driver, the blopex_abstract objects must be compiled and Makefile.inc in ../blopex_serial_double updated with appropriate locations for blopex_abstract, compile flags, and lapack library.  

For example: 
{{{
LOBPCG_ROOT_DIR =  ../../blopex_abstract
CFLAGS = -Wall -g
LAPACKLIB = -llapack
}}}
Then, issue command
{{{
>> make
}}}
This should create a test executable "driver/serial_driver" 

= Test Execution =

To run the executible (which is in ../blopex_serial_double/driver), shift to that directory and enter command  
{{{
>> ./serial_driver R 100 10 
}}}
or
{{{
>> ./serial_driver L test1a.txt test1x.txt
}}}
The first form creates a 100x100 random hermitian matrix and solves for 10 eigenvalues.

The second form loads matrix from test1a.txt, initial eigenvectors from test1x.txt and 
solves for the the same number of eigenvalues as initial eigenvectors.  

= Test file creation =

These files are formated as follows: ascii lines with cr.  
1st line is '%d %d\n'  number of rows, number of columns. 
All other lines, '%22.16e %22.16e\n'   real part of number, imaginary part of number. 
Numbers are in standard fortran row rank order.  

These files can be created in Matlab by 1st setting up the matrix and saving using the 
following (matrix in variable x and x is complex).
{{{
fid = fopen('c:\text1a.txt','w');
[row,col]=size(x);
fprintf(fid,'%d %d\n',row,col);
for j=1:4 
   for i=1:6 
      fprintf(fid,'%22.16e   %22.16e\n',real(x(i,j)),imag(x(i,j)));
   end
end
fclose(fid);
}}}

The matrix to solve should be hermitian positive definite.   

The matrix of initial values should have the same number of rows as the matrix to solve and the number of columns determines the number of eivenvalues to solve for. 