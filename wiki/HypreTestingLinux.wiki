#summary BLOPEX Hypre testing for Linux
<wiki:toc max_depth="1" />

= Introduction =

Testing new BLOPEX in Hypre 2.6.0b. BLOPEX LOBPCG computes a number of smallest eigenpairs utilizing Hypre's IJ, Struct and SStruct interfaces. 
Test drivers ij, struct, sstruct in test and ex11 in examples. 
  

= Setup Hypre =  

See
http://code.google.com/p/blopex/wiki/HypreInstallLinux

= Execution of Tests for Hypre's IJ interface =
4 Quad Core Opteron 2.0 Ghz CPUs, 64 GB RAM. 
Find 20 smallest eigenpairs of 3-D 7-point 64x64x64 Laplacian. Use 2 cores, random guess
and BoomerAMG (default) preconditioner. 
{{{
$ srun -n2  ij -lobpcg -n 64 64 64 -pcgitr 0 -vrand 20 -seed 1
........
Initial Max. Residual   2.43837832680517e+00
Iteration 1 	bsize 20 	maxres   9.27760154340509e-01
Iteration 2 	bsize 20 	maxres   9.95859757156789e-02
Iteration 3 	bsize 20 	maxres   5.35809124539832e-02
........
Iteration 32 	bsize 3 	maxres   1.63915213644935e-08
Iteration 33 	bsize 2 	maxres   1.00061006177016e-08
Iteration 34 	bsize 1 	maxres   9.79423242872933e-09

Eigenvalue lambda       Residual              
  7.00663900604040e-03    3.11322750992554e-09
  1.40078232353962e-02    2.18555493423167e-09
  1.40078232353966e-02    1.56740554270983e-09
........
  3.96606622255917e-02    9.79423242872933e-09
  3.96606622273213e-02    7.52027698802309e-09
  3.96606622335298e-02    7.01148270739451e-09

34 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 157.880000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 157.840000 seconds
  cpu MFLOPS      = 0.000000
}}}

Below are the similar runs and corresponding timings on 4, 8 and 12 cores:
{{{
$ mpirun -np 4 ./ij -lobpcg -n 64 64 64 -pcgitr 0 -vrand 20 -seed 1	
........
Eigenvalue lambda   7.00663900604047e-03
Eigenvalue lambda   1.40078232353951e-02
Eigenvalue lambda   1.40078232353976e-02
........
Eigenvalue lambda   3.96606622273073e-02
Eigenvalue lambda   3.96606622274270e-02
Eigenvalue lambda   3.96606622309705e-02
Residual   3.82339245841408e-09
Residual   3.16097555887773e-09
Residual   3.87442820543904e-09
........
Residual   8.06351772888438e-09
Residual   9.40532480087339e-09
Residual   9.72355853713388e-09

43 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 175.810000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 175.810000 seconds
  cpu MFLOPS      = 0.000000







$ mpirun -np 8 ./ij -lobpcg -n 64 64 64 -pcgitr 0 -vrand 20 -seed 1	
........
Eigenvalue lambda   7.00663900604041e-03
Eigenvalue lambda   1.40078232353957e-02
Eigenvalue lambda   1.40078232353966e-02
........
Eigenvalue lambda   3.96606622272988e-02
Eigenvalue lambda   3.96606622273095e-02
Eigenvalue lambda   3.96606622276261e-02
Residual   3.70085907256198e-09
Residual   4.00319530890741e-09
Residual   4.20084850498391e-09
........
Residual   6.54338573150323e-09
Residual   8.05614030452242e-09
Residual   8.13140916860350e-09

34 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 113.460000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 113.470000 seconds
  cpu MFLOPS      = 0.000000


$ mpirun -np 12 ./ij -lobpcg -n 64 64 64 -pcgitr 0 -vrand 20 -seed 1
........
Eigenvalue lambda   7.00663900603955e-03
Eigenvalue lambda   1.40078232353956e-02
Eigenvalue lambda   1.40078232353959e-02
........
Eigenvalue lambda   3.96606622273043e-02
Eigenvalue lambda   3.96606622273095e-02
Eigenvalue lambda   3.96606622273160e-02
Residual   1.16582909260867e-09
Residual   8.54372572267420e-09
Residual   1.37677311213383e-09
........
Residual   7.99361652917548e-09
Residual   9.46390622434787e-09
Residual   8.40211141630243e-09

35 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 188.470000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 185.710000 seconds
  cpu MFLOPS      = 0.000000
}}}

In all the tests the desired tolerance for residual norms (1e-8) was achieved at each eigenpair.

= Execution of Tests for Hypre's Struct interface =
4 Quad Core Opteron 2.0 Ghz CPUs, 64 GB RAM
Find 20 smallest eigenpairs of 3-D 7-point 64x64x64 Laplacian. Use 2 cores, random guess
and SMG (default) preconditioner.
{{{
$ $ mpirun -np 2 ./struct -lobpcg -P 2 1 1 -n 32 64 64 -pcgitr 0 -tol 1.e-6 -vrand 20 -seed 1
........
Eigenvalue lambda   7.00663900604137e-03
Eigenvalue lambda   1.40078232354006e-02
Eigenvalue lambda   1.40078232354045e-02
........
Eigenvalue lambda   3.96606622278755e-02
Eigenvalue lambda   3.96606622283022e-02
Eigenvalue lambda   3.96606622286556e-02
Residual   7.56594294724381e-08
Residual   3.77279806460283e-07
Residual   7.15222192077976e-07
........
Residual   6.76919987150030e-07
Residual   6.36262557074980e-07
Residual   6.80569313188676e-07

38 iterations
=============================================
Solve phase times:
=============================================
PCG Solve:
  wall clock time = 452.640000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 452.400000 seconds
  cpu MFLOPS      = 0.000000
}}}

Below are the similar runs and corresponding timings on 4 and 8 cores:
{{{
$ mpirun -np 4 ./struct -lobpcg -n 64 64 64 -pcgitr 0 -vrand 20 -seed 1
........
Eigenvalue lambda   7.00663900604177e-03
Eigenvalue lambda   1.40078232353991e-02
Eigenvalue lambda   1.40078232354044e-02
........
Eigenvalue lambda   3.96606622284663e-02
Eigenvalue lambda   3.96606622288324e-02
Eigenvalue lambda   3.96606622321093e-02
Residual   1.45106762486572e-07
Residual   2.74878942841427e-07
Residual   4.88437842422526e-07
........
Residual   9.57985718234993e-07
Residual   7.13935485122067e-07
Residual   8.78169811413180e-07

29 iterations
=============================================
Solve phase times:
=============================================
PCG Solve:
  wall clock time = 238.930000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 238.900000 seconds
  cpu MFLOPS      = 0.000000

$ mpirun -np 8 ./struct -lobpcg -P 8 1 1 -n 8 64 64 -pcgitr 0 -tol 1.e-6 -vrand 20 -seed 1
........
Eigenvalue lambda   7.00663900604125e-03
Eigenvalue lambda   1.40078232353979e-02
Eigenvalue lambda   1.40078232354031e-02
........
Eigenvalue lambda   3.96606622279464e-02
Eigenvalue lambda   3.96606622282876e-02
Eigenvalue lambda   3.96606622288330e-02
Residual   9.75486455152180e-08
Residual   2.70336730473921e-07
Residual   4.31824092087032e-07
........
Residual   9.50887547266384e-07
Residual   8.41228947639852e-07
Residual   7.30405123841645e-07
}}} 

In all the tests the desired tolerance for residual norms (1e-6) was achieved at each eigenpair.

Note: dimensions _-n nx ny nz_ in the driver's parameter list, are assumed to be per processor, while the processors topology is defined by _-P Px Py Pz_.  

= Execution of Tests for Hypre's SStruct interface =
4 Quad Core Opteron 2.0 Ghz CPUs, 64 GB RAM
To test Hypre's SStruct interface we use the default input file sstuct.in.default (can be found in src/test/TEST_sstruct and
copied to src/test). We compute 10 smallest eigenpairs using 2 cores, random initial guess and SMG preconditioner:
{{{
$ mpirun -np 2 ./sstruct -P 1 1 2 -lobpcg -solver 10 -tol 1.e-6 -pcgitr 0 -seed 1 -vrand 10
........
Eigenvalue lambda   1.34880848246863e+00
Eigenvalue lambda   1.36560847743438e+00
Eigenvalue lambda   1.47908699641544e+00
........
Eigenvalue lambda   1.81237285972004e+00
Eigenvalue lambda   1.82920488646823e+00
Eigenvalue lambda   1.84668108359500e+00
Residual   8.63315860537788e-07
Residual   7.12441393056327e-07
Residual   8.01558894158301e-07
........
Residual   9.25493675135675e-07
Residual   8.43603987608139e-07
Residual   1.01253511015489e-06

100 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 22.330000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 22.340000 seconds
  cpu MFLOPS      = 0.000000
}}}
Compute 10 smallest eigenpairs using 2 cores, random initial guess and PFMG preconditioner:
{{{
$ mpirun -np 2 ./sstruct -P 1 1 2 -lobpcg -solver 11 -tol 1.e-6 -pcgitr 0 -seed 1 -vrand 10
........
Eigenvalue lambda   1.34880848246839e+00
Eigenvalue lambda   1.36560847743322e+00
Eigenvalue lambda   1.47908699640858e+00
........
Eigenvalue lambda   1.81237285962400e+00
Eigenvalue lambda   1.82920488646689e+00
Eigenvalue lambda   1.84668108358911e+00
Residual   7.70861397184120e-07
Residual   7.60135735509432e-07
Residual   9.62472434545365e-07
........
Residual   9.97971662032563e-07
Residual   9.98086843726105e-07
Residual   2.13094634006495e-06

100 iterations
=============================================
Solve phase times:
=============================================
LOBPCG Solve:
  wall clock time = 5.300000 seconds
  wall MFLOPS     = 0.000000
  cpu clock time  = 5.300000 seconds
  cpu MFLOPS      = 0.000000
}}}

For both cases the desired tolerance (1e-6) for residual norms was achieved at each eigenpair.