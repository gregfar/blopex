#summary BLOPEX Double Petsc testing on Windows XP
<wiki:toc max_depth="1" />

= Introduction =

How to test BLOPEX Double under Petsc-3.1-p2 on Windows XP

= Setup Petsc =  

To use blopex_solve_double using the  Petsc first download the development version from 
the Petsc website at http://www.mcs.anl.gov/petsc/petsc-as/download/index.html
In particular, if you install in windows, see http://www.mcs.anl.gov/petsc/petsc-as/documentation/installation.html#Windows. One can download Cygwin from http://cygwin.com/.

I download Petsc-3.1-p2 in L:/pei/petsc_double. To install files issue command:
{{{
>> cd  /cygdrive/l/pei/petsc_double
>> gunzip -c petsc-3.1-p2.tar.gz | tar -xof - 
}}}
This creates files in directory petsc-3.1-p2

Then
{{{
cd petsc-3.1-p2
export PETSC_DIR=$PWD
}}}

Download the blopex_petsc_interface.tar.gz and blopex_petsc_abstract.tar.gz from the Blopex Google Code site http://code.google.com/p/blopex and then move them to your home directory.

Assuming you are in your home directory such as /cygdrive/l/pei/petsc_double, install as follows:
{{{
>> tar -zxvf blopex_petsc_interface.tar.gz
}}}

Configure Petsc as follows:
{{{
>> ./config/configure.py  --download-f-blas-lapack=1 --download-mpich=1 --download-blopex=/cygdrive/l/pei/petsc_double/blopex_petsc_abstract.tar.gz
}}}


After configuration is finished issue the command
{{{
>> make all 
>> make test
}}}

= Setup blopex_petsc =  
 
Now create executables for the blopex drivers 
{{{
>> cd petsc-3.1-p2/src/contrib/blopex/driver
>> make driver
>> cd ../driver_fiedler
>> make driver_fiedler
}}}

= Execution of Tests =

There are two test drivers located in subdirectories of blopex_petsc:
driver an driver_fiedler.  The executables for these are in directories
petsc_dir/src/contrib/blopex/driver and petsc_dir/src/contrib/blopex/driver_fiedler.

driver builds a 7pt laplacian for solution and calls  lobpcg_solve_double, since Petsc is configured for double. 

For example:
{{{
>> ./driver -n_eigs 4 -itr 20 >testdouble.doc
}}}
Save the output result in file testdouble.doc.
{{{
Partitioning: 1 1 1
Preconditioner setup, seconds: 0.001005
Solving standard eigenvalue problem with preconditioning

block size4
No constraints
Initial Max. Residual   2.40609319513876e+00
Iteration 1 	bsize 4 	maxres   1.40642211978996e+00
Iteration 2 	bsize 4 	maxres   5.02760800609410e-01
Iteration 3 	bsize 4 	maxres   3.93623262505509e-01
Iteration 4 	bsize 4 	maxres   1.60680169022797e-01
Iteration 5 	bsize 4 	maxres   3.77313261807019e-02
Iteration 6 	bsize 4 	maxres   1.12801976826879e-02
Iteration 7 	bsize 4 	maxres   1.66006100058035e-03
Iteration 8 	bsize 4 	maxres   3.61387759393677e-04
Iteration 9 	bsize 4 	maxres   7.37015225576054e-05
Iteration 10 	bsize 4 	maxres   2.66979360160027e-05
Iteration 11 	bsize 3 	maxres   7.01936652023119e-06
Iteration 12 	bsize 3 	maxres   1.60098479070793e-06
Iteration 13 	bsize 3 	maxres   4.53263182259180e-07
Iteration 14 	bsize 3 	maxres   5.98853182054774e-08
Iteration 15 	bsize 3 	maxres   1.30136443945144e-08
Iteration 16 	bsize 3 	maxres   3.11832407459781e-09

Eigenvalue lambda       Residual              
  2.43042158313016e-01    2.10410583168116e-09
  4.79521039879646e-01    3.11832407459781e-09
  4.79521039879650e-01    2.98754868633799e-09
  4.79521039879653e-01    2.68672608547834e-09

16 iterations
Solution process, seconds: 5.043915e-01
}}}

We first run driver_fiedler for the matrix provided in _L-matrix-double.petsc_.
For example:
{{{
>> ./driver_fiedler -matrix L-matrix-double.petsc -n_eigs 4 -itr 20 >1.doc
}}}
Save the output result in file 1.doc.

{{{
Preconditioner setup, seconds: 0.206715
Solving standard eigenvalue problem with preconditioning
block size 4

1 constraint
Initial Max. Residual   1.45519099953812e+00
Iteration 1 	bsize 4 	maxres   9.05087940709310e-04
Iteration 2 	bsize 4 	maxres   2.39221179416152e-04
Iteration 3 	bsize 4 	maxres   1.87262105933628e-04
Iteration 4 	bsize 4 	maxres   2.05953528268151e-04
Iteration 5 	bsize 4 	maxres   7.09301312527200e-05
Iteration 6 	bsize 3 	maxres   2.18857830352927e-05
Iteration 7 	bsize 3 	maxres   7.38935901673601e-06
Iteration 8 	bsize 2 	maxres   3.37368636921290e-06
Iteration 9 	bsize 2 	maxres   2.35199689607197e-06
Iteration 10 	bsize 2 	maxres   1.04900158672169e-06
Iteration 11 	bsize 2 	maxres   2.93046178784941e-07
Iteration 12 	bsize 1 	maxres   1.17199707404717e-07
Iteration 13 	bsize 1 	maxres   4.97717504594874e-08
Iteration 14 	bsize 1 	maxres   2.60491750604494e-08
Iteration 15 	bsize 1 	maxres   1.12406936225263e-08
Iteration 16 	bsize 1 	maxres   9.91941916669244e-09

Eigenvalue lambda       Residual              
  3.24057229832643e-06    7.86279163265225e-10
  9.46022689441448e-06    2.02253778797195e-09
  2.01380537109246e-05    9.91941916669244e-09
  2.39583260612299e-05    6.19645713745670e-09

16 iterations
Solution process, seconds: 7.210370e+02
Final eigenvalues:
3.240572e-06
9.460227e-06
2.013805e-05
2.395833e-05
}}}

Now we run similar tests for the matrix provided in _DL-matrix-double.petsc_.
{{{
$./driver_fiedler -matrix DL-matrix-double.petsc -n_eigs 4  -itr 20 >2.doc
}}}
Save the output result in file 2.doc.

{{{
Preconditioner setup, seconds: 0.187320
Solving standard eigenvalue problem with preconditioning
block size 4

1 constraint

Initial Max. Residual   9.30504349241123e-01
Iteration 1 	bsize 4 	maxres   1.60933722979713e-02
Iteration 2 	bsize 4 	maxres   9.71254073702964e-03
Iteration 3 	bsize 4 	maxres   1.93810873354354e-03
Iteration 4 	bsize 4 	maxres   7.88025911920671e-04
Iteration 5 	bsize 4 	maxres   3.33356209786235e-04
Iteration 6 	bsize 4 	maxres   2.75095160484097e-04
Iteration 7 	bsize 4 	maxres   2.08525962509773e-04
Iteration 8 	bsize 4 	maxres   1.64269285688367e-04
Iteration 9 	bsize 4 	maxres   1.65574819609620e-04
Iteration 10 	bsize 4 	maxres   1.27822989524027e-04
Iteration 11 	bsize 4 	maxres   1.04802219934669e-04
Iteration 12 	bsize 4 	maxres   1.11437834825403e-04
Iteration 13 	bsize 4 	maxres   1.05002753508993e-04
Iteration 14 	bsize 4 	maxres   7.37718385144399e-05
Iteration 15 	bsize 4 	maxres   7.04144115253489e-05
Iteration 16 	bsize 4 	maxres   4.11646007287232e-05
Iteration 17 	bsize 4 	maxres   4.11114688194940e-05
Iteration 18 	bsize 4 	maxres   3.94082303167608e-05
Iteration 19 	bsize 4 	maxres   4.71440345324343e-05
Iteration 20 	bsize 4 	maxres   3.37555345080628e-05

Eigenvalue lambda       Residual              
  4.02180330475384e-05    2.40839602288392e-05
  4.02557767575617e-05    8.55127947199847e-06
  4.03477225760208e-05    3.31952148670252e-05
  4.05149879367504e-05    3.37555345080628e-05

20 iterations
Solution process, seconds: 4.487084e+00
Final eigenvalues:
4.021803e-05
4.025578e-05
4.034772e-05
4.051499e-05
}}}